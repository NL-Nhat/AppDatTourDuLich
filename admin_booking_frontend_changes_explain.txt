TỔNG HỢP THAY ĐỔI FRONTEND (ANDROID) - ADMIN QUẢN LÝ ĐẶT TOUR
==========================================================

Phạm vi đã làm
--------------
1) Admin xem danh sách đơn đặt tour + lọc theo trạng thái + tìm kiếm.
2) Admin xem chi tiết đơn đặt tour (UI đẹp hơn: card, ảnh tour, avatar khách, chip trạng thái).
3) Admin duyệt (confirm) / hủy (cancel + nhập lý do) đơn đặt tour ở cả List và Detail.

Backend API được sử dụng
------------------------
- GET  /api/admin/bookings?status=&q=
- GET  /api/admin/bookings/{maDatTour}
- POST /api/admin/bookings/{maDatTour}/confirm
- POST /api/admin/bookings/{maDatTour}/cancel   (body: {"lyDoHuy":"..."})

Lưu ý xác thực:
- ApiClient trong app đã tự gắn header Authorization: Bearer <token> (lấy từ QuanLyDangNhap).
- Backend yêu cầu ROLE_Admin cho /api/admin/**.


A) FILE TẠO MỚI (NEW FILES)
===========================

1) Model: AdminBookingItem
--------------------------
File: AppDatTourDuLich/app/src/main/java/com/example/apptravel/data/models/AdminBookingItem.java
Mục đích:
- Là model phía Android map 1-1 với backend DTO `AdminBookingItemDTO`.
- Dùng cho cả màn List và Detail.

Các field chính:
- Booking: maDatTour, soNguoiLon, soTreEm, tongTien, trangThaiDatTour, trangThaiThanhToan, ngayDat, ngayHuy, lyDoHuy
- Lịch khởi hành: maLichKhoiHanh, ngayKhoiHanh, ngayKetThuc
- Tour: maTour, tenTour, diaDiem, urlHinhAnhChinh
- Khách hàng: maNguoiDung, hoTen, email, soDienThoai, anhDaiDien


2) Repository: AdminBookingRepository
------------------------------------
File: AppDatTourDuLich/app/src/main/java/com/example/apptravel/data/repository/AdminBookingRepository.java
Mục đích:
- Đóng gói các lệnh gọi API admin bookings (Retrofit) để UI gọi gọn.

Hàm chính:
- getBookings(status, q): lấy danh sách booking theo filter/search
- getBookingDetail(maDatTour): lấy chi tiết
- confirmBooking(maDatTour): duyệt đơn
- cancelBooking(maDatTour, lyDoHuy): hủy đơn (gửi CancelBookingRequest)


3) Adapter: BookingAdminAdapter
------------------------------
File: AppDatTourDuLich/app/src/main/java/com/example/apptravel/data/adapters/BookingAdminAdapter.java
Mục đích:
- Adapter cho RecyclerView ở màn danh sách admin bookings.
- Bind dữ liệu vào item_booking_admin.xml.

Tính năng:
- Hiển thị: tên khách, SĐT, tên tour, ngày đi-về, số người, tổng tiền, trạng thái đặt, trạng thái thanh toán.
- Load avatar khách bằng Glide (qua ApiClient.getFullImageUrl("avatar/..."))
- Nút hành động:
  - Chi tiết: luôn hiện
  - Xác nhận: chỉ hiện nếu trangThaiDatTour = ChoXacNhan
  - Hủy: ẩn nếu trangThaiDatTour = DaHuy


4) Activity: AdminBookingDetailActivity
--------------------------------------
File: AppDatTourDuLich/app/src/main/java/com/example/apptravel/ui/activitys/admin/AdminBookingDetailActivity.java
Mục đích:
- Màn “Chi tiết đơn đặt tour” cho admin.
- Gọi API GET /api/admin/bookings/{id} để load.
- Hiển thị UI dạng card (đẹp hơn): ảnh tour, avatar khách, chip trạng thái.

Chức năng:
- Load ảnh tour: uploads/tour/{urlHinhAnhChinh}
- Load avatar: uploads/avatar/{anhDaiDien}
- Nút Confirm/Cancel:
  - Confirm: chỉ hiện khi ChoXacNhan
  - Cancel: ẩn khi DaHuy
  - Cancel có dialog nhập lý do (dialog_admin_booking_cancel.xml)


5) Layout: activity_admin_booking_detail.xml
-------------------------------------------
File: AppDatTourDuLich/app/src/main/res/layout/activity_admin_booking_detail.xml
Mục đích:
- Layout UI “đẹp” cho màn chi tiết.
- Bố cục gồm:
  - Header card: ảnh tour + mã đơn + chip trạng thái
  - Card khách hàng: avatar + thông tin liên hệ
  - Card tour: ngày đi, số người, tổng tiền
  - Card thông tin đơn: ngày đặt/ngày hủy/lý do hủy
  - Bottom action bar: nút Hủy / Xác nhận


6) Dialog layout: Search
-----------------------
File: AppDatTourDuLich/app/src/main/res/layout/dialog_admin_booking_search.xml
Mục đích:
- Dialog nhập từ khóa q (mã đơn/tên tour/họ tên/email/sđt)
- Dùng trong BookingAdminFragment.


7) Dialog layout: Filter
-----------------------
File: AppDatTourDuLich/app/src/main/res/layout/dialog_admin_booking_filter.xml
Mục đích:
- Dialog chọn trạng thái (Tất cả/Chờ xác nhận/Đã xác nhận/Đã hủy)
- Dùng trong BookingAdminFragment.


8) Dialog layout: Cancel reason
------------------------------
File: AppDatTourDuLich/app/src/main/res/layout/dialog_admin_booking_cancel.xml
Mục đích:
- Dialog nhập “Lý do hủy” khi admin hủy booking.
- Dùng cho cả List và Detail.


9) Drawable “chip” trạng thái
-----------------------------
Files:
- AppDatTourDuLich/app/src/main/res/drawable/bg_chip_pending.xml
- AppDatTourDuLich/app/src/main/res/drawable/bg_chip_confirmed.xml
- AppDatTourDuLich/app/src/main/res/drawable/bg_chip_cancelled.xml
- AppDatTourDuLich/app/src/main/res/drawable/bg_chip_paid.xml
Mục đích:
- Tạo background bo tròn kiểu “chip” cho trạng thái đặt tour / thanh toán ở màn detail.



B) FILE ĐÃ SỬA (MODIFIED FILES)
===============================

1) ApiService.java
------------------
File: AppDatTourDuLich/app/src/main/java/com/example/apptravel/data/api/ApiService.java
Thay đổi:
- Thêm import AdminBookingItem
- Thêm 4 endpoint admin bookings:
  - getAdminBookings(status, q)
  - getAdminBookingDetail(id)
  - confirmAdminBooking(id)
  - cancelAdminBooking(id, request)

Mục đích:
- Cho app gọi đúng API backend /api/admin/bookings.


2) BookingAdminFragment.java
----------------------------
File: AppDatTourDuLich/app/src/main/java/com/example/apptravel/ui/fragments/admin/BookingAdminFragment.java
Thay đổi/chức năng:
- Setup RecyclerView + BookingAdminAdapter
- Tabs lọc status: Tất cả / ChoXacNhan / DaXacNhan / DaHuy
- Search (q): mở dialog_admin_booking_search, lưu currentQuery
- Filter dialog: dialog_admin_booking_filter, đồng bộ với TabLayout
- Confirm/Cancel:
  - confirmBooking(): gọi repo.confirmBooking(id)
  - showCancelDialog(): dialog nhập lý do -> gọi repo.cancelBooking(id, reason)
- Sau thao tác: refresh list bằng loadBookings()


3) item_booking_admin.xml
-------------------------
File: AppDatTourDuLich/app/src/main/res/layout/item_booking_admin.xml
Thay đổi:
- Thêm id cho avatar: @+id/customer_avatar (để adapter load ảnh)
- Thêm nút @+id/btn_cancel (Hủy) ở khu vực Actions.


4) AndroidManifest.xml
----------------------
File: AppDatTourDuLich/app/src/main/AndroidManifest.xml
Thay đổi:
- Khai báo activity mới:
  - .ui.activitys.admin.AdminBookingDetailActivity



C) FILE BỊ XÓA (DELETED FILES)
==============================
- Không có file nào bị xóa trong phạm vi thay đổi này.


D) LUỒNG HOẠT ĐỘNG (TÓM TẮT)
============================

1) Admin mở tab "Đặt tour" (BookingAdminFragment)
- Gọi GET /api/admin/bookings?status=<tab>&q=<search>
- Hiển thị list bằng BookingAdminAdapter

2) Bấm "Chi tiết"
- Mở AdminBookingDetailActivity
- Activity gọi GET /api/admin/bookings/{maDatTour}
- Bind UI + load ảnh

3) Bấm "Xác nhận"
- Gọi POST /api/admin/bookings/{id}/confirm
- Refresh (list hoặc reload detail)

4) Bấm "Hủy"
- Mở dialog nhập lý do
- Gọi POST /api/admin/bookings/{id}/cancel (body lyDoHuy)
- Refresh (list hoặc reload detail)


E) GHI CHÚ BUILD
================
- Build/assembleDebug chạy OK với JDK 21.
- Nếu chạy bằng JDK 25 có thể lỗi Gradle/Kotlin DSL (IllegalArgumentException: 25).

(End)
